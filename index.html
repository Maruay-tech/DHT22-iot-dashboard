
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸŒ¡ï¸ Realtime Temp & Humidity</title>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; margin: 20px; }
    canvas { max-width: 100%; height: auto; }
    h1 { font-size: 1.4em; text-align: center; }
  </style>
</head>
<body>
  <h1>ğŸŒ¡ï¸ Realtime Temperature & ğŸ’§ Humidity (Last 3 Months)</h1>
  <canvas id="chart"></canvas>

  <script>
    FileInputStream serviceAccount =
new FileInputStream("path/to/serviceAccountKey.json");

FirebaseOptions options = new FirebaseOptions.Builder()
  .setCredentials(GoogleCredentials.fromStream(serviceAccount))
  .setDatabaseUrl("https://esp8266-8198b-default-rtdb.asia-southeast1.firebasedatabase.app")
  .build();

FirebaseApp.initializeApp(options);

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const labels = [], temps = [], hums = [];
    const now = Math.floor(Date.now() / 1000);
    const start = now - 60 * 60 * 24 * 90;

    db.ref("logs").orderByKey().startAt(String(start)).once("value", snapshot => {
      snapshot.forEach(child => {
        const t = new Date(child.key * 1000);
        labels.push(t.toLocaleDateString() + " " + t.toLocaleTimeString());
        temps.push(child.val().temperature);
        hums.push(child.val().humidity);
      });
      renderChart();
    });

    function renderChart() {
      new Chart(document.getElementById("chart"), {
        type: "line",
        data: {
          labels,
          datasets: [
            { label: "Temperature (Â°C)", data: temps, borderColor: "red", fill: false },
            { label: "Humidity (%)", data: hums, borderColor: "blue", fill: false }
          ]
        },
        options: { responsive: true, maintainAspectRatio: false }
      });
    }
  </script>
</body>
</html>
